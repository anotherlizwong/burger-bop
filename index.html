<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Burger Bop</title>
</head>
<body>

<div id="container">

    <span id="spinner_1">SPIN!</span> |
    <span id="spinner_2">SPIN!</span> |
    <span id="spinner_3">SPIN!</span>
    <hr/>
    <button id="bop">Bop!</button>

</div>

<script src="libs/jquery-2.2.0.js"></script>
<script src="libs/underscore.js"></script>
<script src="libs/backbone.js"></script>
<script src="data.js"></script>

<script>

    (function ($) {
        var app = {};
        app.Spinner = Backbone.Model.extend({
            defaults: {
                value: undefined,
                class: undefined,
                index: undefined
            },
            randomizeValue: function (skip) {
                while (true) {
                    this.index = Math.floor((Math.random() * data.length));
                    // break out of this loop only if the slot hasn't already been already displayed
                    if (-1 === $.inArray(this.index, skip)) {
                        break;
                    }
                } 
                this.value = data[this.index].name;
                this.class = data[this.index].class;
            }
        });
        app.SpinnerView = Backbone.View.extend({
            initialize: function () {
                this.model = new app.Spinner();
            },
            render: function () {
                this.$el.text(this.model.value);
                this.$el.removeClass();
                this.$el.addClass(this.model.class);

            },
            spin: function (skip) {
                this.model.randomizeValue(skip);
                this.render();
                return this.model.index;
            }
        });
        app.SlotMachine = Backbone.View.extend({});
        app.SlotMachineView = Backbone.View.extend({
            el: '#container',
            events: {
                "click button#bop": "bop"
            },
            initialize: function () {
                this.model = new app.SlotMachine();
                this.spinner1 = new app.SpinnerView({el: $('#spinner_1')});
                this.spinner2 = new app.SpinnerView({el: $('#spinner_2')});
                this.spinner3 = new app.SpinnerView({el: $('#spinner_3')});
                this.$bop = $('#bop');
            },
            bop: function () {
                var skip = [];
                skip.push(this.spinner1.spin());
                skip.push(this.spinner2.spin(skip));
                this.spinner3.spin(skip);
            }
        });
        var slotMachine = new app.SlotMachineView();
    })(jQuery);
</script>
</body>
</html>
<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Burger Bop!</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="normalize.css">
    <link rel="stylesheet" href="skeleton.css">

    <style type="text/css">

        table {
            border-collapse: collapse;
        }

        table td {
            /*border: 1px solid black;*/
            margin: 5px;
            height: 140px;
            width: 172px;
        }

        table td {
            vertical-align: top;
            text-align: left;
            border-bottom:none;
        }

        .slot {
            background-repeat: no-repeat;
        }

    </style>
</head>
<body>

<div class="container" id="container" style="text-align: center;">
    <img src="assets/burgerbop.png"/>


    <table align="center">
        <tr>
            <td id="spinner_1" class="slot"></td>
            <td id="spinner_2" class="slot"></td>
            <td id="spinner_3" class="slot"></td>
        </tr>
    </table>
    <div>
        <button id="bop">Bop!</button>
    </div>
</div>

<script src="libs/jquery-2.2.0.js"></script>
<script src="libs/underscore.js"></script>
<script src="libs/backbone.js"></script>
<script src="data.js"></script>

<script>

    (function ($) {
        var app = {};
        app.Spinner = Backbone.Model.extend({
            defaults: {
                value: 'SPIN!',
                class: '',
                index: undefined
            },
            randomizeValue: function (model) {
//                while (true) {
                model.set('index', Math.floor((Math.random() * data.length)));
                // break out of this loop only if the slot hasn't already been already displayed
//                    if (-1 === $.inArray(model.get('index'), skip)) {
//                        break;
//                    }
//                }
                model.set('class', data[model.get('index')].class);
                model.set('value', data[model.get('index')].name);
            }
        });
        app.SpinnerView = Backbone.View.extend({
            initialize: function () {
                debugger;
                this.model = new app.Spinner();
                this.listenTo(this.model, 'change:value', this.render);
                this.render();
            },
            render: function () {
                debugger;
                this.$el.text(this.model.get('value'));
                this.$el.css('background-image', 'url(assets/' + this.model.get('class') + '.png)'); //(this.model.get('class'));
            },
            spin: function (skip) {
                debugger;
                for (var i = 0; i < 20; i++) {
                    _.delay(this.model.randomizeValue, i * 100, this.model);
                }
//                this.render();
//                return this.model.index;
            }
        });
        app.SlotMachine = Backbone.View.extend({});
        app.SlotMachineView = Backbone.View.extend({
            el: '#container',
            events: {
                "click button#bop": "bop"
            },
            initialize: function () {
                this.model = new app.SlotMachine();
                this.spinner1 = new app.SpinnerView({el: $('#spinner_1')});
                this.spinner2 = new app.SpinnerView({el: $('#spinner_2')});
                this.spinner3 = new app.SpinnerView({el: $('#spinner_3')});
                this.$bop = $('#bop');
            },
            bop: function () {
                this.spinner1.spin();
                this.spinner2.spin();
                this.spinner3.spin();
//
//                var skip = [];
//                skip.push(this.spinner1.spin());
//                skip.push(this.spinner2.spin(skip));
//                this.spinner3.spin(skip);
//                this.$bop.html('stop');
            }
        });
        var slotMachine = new app.SlotMachineView();
    })(jQuery);
</script>
</body>
</html>